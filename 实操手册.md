# 游戏集成实操手册

以记忆卡片游戏为例，展示完整的集成过程。

## 📁 创建游戏目录

```bash
games/memory-cards/
├── game.html          # 游戏界面
├── game.css           # 游戏样式  
└── game.js            # 游戏逻辑（核心文件）
```

## 🎮 核心游戏类实现

### games/memory-cards/game.js

```javascript
class MemoryCardsGame {
    constructor() {
        this.gameState = {
            isRunning: false, isPaused: false, currentRound: 0, score: 0,
            cards: [], flippedCards: [], matchedPairs: 0
        };
        this.gameData = { rounds: [], currentRoundData: null };
        this.initializeGame();
    }

    // 🔴 必须实现 - 监听训练系统
    initializeGame() {
        window.addEventListener('trainingSystemEvent', (event) => {
            this.handleTrainingEvent(event.detail);
        });
    }

    // 🔴 必须实现 - 处理训练事件
    handleTrainingEvent(eventDetail) {
        switch (eventDetail.event) {
            case 'training_start': this.startFirstRound(); break;
            case 'training_pause': this.pauseGame(); break;
            case 'training_resume': this.resumeGame(); break;
            case 'training_end': this.endAllRounds(); break;
        }
    }

    startFirstRound() {
        this.gameState.currentRound++;
        this.gameState.isRunning = true;
        
        this.gameData.currentRoundData = {
            roundNumber: this.gameState.currentRound,
            startTime: Date.now(),
            score: 0, matches: 0, mistakes: 0, events: []
        };
        
        this.setupCards();
        this.recordEvent('round_started');
    }

    // 🔴 必须实现 - 报告数据
    reportToTrainingSystem() {
        const report = {
            gameType: 'memory_cards',
            currentRound: this.gameState.currentRound,
            roundData: this.gameData.currentRoundData,
            totalStats: { /* 统计数据 */ },
            cognitiveMetrics: this.calculateCognitiveMetrics()
        };
        
        if (window.TrainingAPI) {
            TrainingAPI.reportGameData(report);
        }
    }

    // 🔴 必须实现 - 认知分析
    calculateCognitiveMetrics() {
        const rounds = this.gameData.rounds;
        const mean = arr => arr.reduce((sum, val) => sum + val, 0) / arr.length;
        
        return {
            learningMemory: {
                workingMemory: {
                    memoryAccuracy: mean(rounds.map(r => r.matches / (r.matches + r.mistakes)))
                }
            },
            attention: {
                sustainedAttention: {
                    consistencyIndex: this.calculateConsistency(rounds.map(r => r.score))
                }
            }
        };
    }
}
```

## 🎨 游戏样式

### games/memory-cards/game.css

```css
.memory-game-board {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    max-width: 400px;
    margin: 20px auto;
}

.memory-card {
    width: 80px; height: 80px;
    background: #3498db;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.memory-card:hover { transform: scale(1.05); }
.memory-card.flipped { background: #2ecc71; }
.memory-card.matched { background: #e74c3c; opacity: 0.6; }
```

## 📄 游戏页面

### memory-cards-game.html

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>记忆卡片游戏 - 心理测量训练</title>
    <link rel="stylesheet" href="game-template/template.css">
    <link rel="stylesheet" href="games/memory-cards/game.css">
</head>
<body>
    <div class="game-platform">
        <!-- 标准控制栏 -->
        <div class="control-bar">...</div>
        
        <!-- 游戏容器 -->
        <div class="game-container">
            <div id="game-content" class="game-content">
                <div id="memory-game-board"></div>
                
                <div class="game-instruction">
                    <p><strong>🎮 游戏说明</strong></p>
                    <p>🧠 点击卡片找到相同的一对</p>
                    <p>🎯 训练目标：提高工作记忆和注意力</p>
                </div>
            </div>
        </div>
        
        <!-- 信息栏 -->
        <div class="info-bar">...</div>
    </div>

    <script src="game-template/template.js"></script>
    <script src="games/memory-cards/game.js"></script>
</body>
</html>
```

## 🏠 更新主页

在index.html添加游戏卡片：

```html
<div class="game-card">
    <div class="game-icon">
        <i class="fas fa-brain"></i>
    </div>
    <h3>记忆卡片游戏</h3>
    <p>训练工作记忆和注意力的经典游戏</p>
    <a href="memory-cards-game.html" class="game-btn">开始训练</a>
</div>
```

## ✅ 核心检查清单

### 必须实现的方法：
- [ ] `handleTrainingEvent()` - 处理训练系统事件
- [ ] `reportToTrainingSystem()` - 报告数据给训练系统  
- [ ] `calculateCognitiveMetrics()` - 计算认知指标
- [ ] `recordEvent()` - 记录关键事件

### 必须处理的事件：
- [ ] `training_start` - 开始训练
- [ ] `training_pause` - 暂停游戏
- [ ] `training_resume` - 恢复游戏
- [ ] `training_end` - 结束训练

### 数据格式要求：
- [ ] 轮次数据包含：开始时间、结束时间、得分、事件
- [ ] 认知指标符合五大领域框架
- [ ] JSON输出格式正确

## 🧪 简单测试

```javascript
// 在浏览器控制台运行
function quickTest() {
    console.log('游戏对象:', typeof window.memoryCardsGame);
    console.log('必需方法:', 
        typeof window.memoryCardsGame?.handleTrainingEvent === 'function');
}
```

## 🎯 快速复制流程

1. **复制Snake游戏目录** → `games/memory-cards/`
2. **修改game.js核心逻辑** → 保持接口不变
3. **调整game.css样式** → 适配新游戏
4. **创建游戏页面** → 使用标准模板
5. **更新主页** → 添加游戏卡片
6. **测试验证** → 确保功能完整

按照这个实操手册，20分钟内完成新游戏集成！🚀 