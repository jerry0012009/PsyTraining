# 缺失数字游戏（禅模式）- 数据保存方式

## 游戏简介
缺失数字游戏（禅模式）是一个基于Phaser框架开发的认知训练游戏，旨在测试和提升玩家的问题解决技能和数学推理能力。玩家需要找出算数题中缺失的数字来完成加法运算。

## 数据保存机制

### 1. 数据收集流程
- **数据临时存储**: 使用 `inputData(field, value)` 函数将每个字段存储到 `this.data` 对象
- **数据提交**: 使用 `sendData(trial)` 函数将当前题目的完整数据推送到 `this.taskdata` 数组
- **批量保存**: 游戏结束时（`data.finished == 1`）触发数据序列化和保存流程

### 2. 主要保存方式
- **方法**: AJAX POST 请求
- **目标端点**: `/save`
- **数据格式**: JSON序列化的试验数据数组
- **数据类型**: `text/json;charset=utf-8`

### 3. 备用保存方式
当服务器端点不可用时，系统会自动启用本地下载保存：
- **触发条件**: AJAX请求失败（非200状态码）
- **延迟机制**: 2秒延迟后显示下载按钮
- **保存方式**: 浏览器下载JSON文件
- **文件名**: `whats-missing-zen_result.json`
- **用户界面**: 显示"下载"按钮供用户手动下载

## 数据结构

每个试验记录包含以下字段：

```json
{
  "answer": "用户输入的答案",
  "problem": "题目描述（如：3 + ? = 8）", 
  "n1": "第一个操作数",
  "n2": "第二个操作数",
  "problem_id": "题目ID",
  "points": "当前得分",
  "solution": "正确答案",
  "RT": "反应时间（秒）",
  "ACC": "正确性（1=正确，0=错误）",
  "finished": "是否完成游戏（1=完成，0=未完成）",
  "trial": "试验次数"
}
```

### 示例数据
```json
[
  {
    "answer": 5,
    "problem": "3 + ? = 8",
    "n1": 3,
    "n2": 5, 
    "problem_id": 0,
    "points": 1,
    "solution": 8,
    "RT": 2.156,
    "ACC": 1,
    "finished": 0,
    "trial": 1
  },
  {
    "answer": 7,
    "problem": "6 + 7 = ?",
    "n1": 6,
    "n2": 7,
    "problem_id": 1, 
    "points": 2,
    "solution": 13,
    "RT": 1.923,
    "ACC": 1,
    "finished": 1,
    "trial": 2
  }
]
```

## 技术实现细节

### 关键文件和函数位置
- **主数据保存逻辑**: `index.html` (第29-81行)
- **数据收集函数**: `js/Instructions.js` (第330-359行的save函数)
- **游戏状态管理**: 基于Phaser.js框架实现

### 数据收集时机
1. **每次提交答案后**: 调用save函数收集当前试验数据
2. **游戏完成时**: 设置finished=1并触发最终数据保存
3. **实时更新**: 得分、反应时间等数据实时记录

### 游戏模式
- **代数模式** (algebra=true): 求解缺失的加数（如：3 + ? = 8）
- **算术模式** (algebra=false): 求解加法结果（如：3 + 5 = ?）

## 性能和奖励机制

### 得分系统
- 正确答案：+1分
- 错误答案：-1分（最低0分）
- 连续正确奖励：3连、7连、15连、26连等里程碑额外加分

### 反应时间记录
- 以毫秒为单位记录用户从题目显示到提交答案的时间
- 保存时转换为秒（除以1000）
- 用于评估用户的处理速度和认知能力

## 使用说明

1. **正常流程**: 游戏完成后数据自动通过AJAX发送到服务器
2. **离线模式**: 服务器不可用时，等待2秒后显示下载按钮
3. **数据完整性**: 每个试验的完整数据都会被记录，包括错误答案
4. **中文界面**: 游戏界面和反馈信息已本地化为中文

## 注意事项

- 游戏使用Phaser游戏引擎，需要现代浏览器支持
- 数据保存前会等待游戏完全结束（finished=1）
- 本地保存的JSON文件包含完整的试验序列，可直接用于数据分析
- 系统会记录所有尝试，包括重复答错的题目
- 支持定时和不定时两种游戏模式