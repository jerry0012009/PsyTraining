# 认知估计测试 - 数据保存机制

## 概述
认知估计测试是一个基于jsPsych框架的认知评估游戏，要求参与者对9个数值问题进行合理估计，用于评估个体的数值推理能力和认知灵活性。

## 数据保存机制

### 保存位置和方式
- **主要方式**: AJAX POST请求到服务器端点 `/save`
- **备用方式**: 当服务器不可用时，使用jsPsych内置的本地保存功能
- **文件格式**: CSV格式
- **文件名**: `cognitive-estimation-test.csv`

### 数据保存流程
1. 参与者完成所有估计问题
2. jsPsych框架触发 `on_finish` 回调函数
3. 序列化所有实验数据为JSON格式
4. 通过 `sendResults()` 函数处理数据保存
5. 优先尝试POST到服务器，失败则本地保存

### 保存的数据结构
jsPsych自动收集的数据包括：
```javascript
{
  "trial_type": "survey-html-form",     // 试验类型
  "trial_index": 2,                     // 试验序号
  "time_elapsed": 15243,                // 总耗时(毫秒)
  "response": {"response": "200"},      // 用户的数值估计
  "stimulus": "<p class=\"h3\">哈雷戴维森摩托车的最高速度是多少？", // 问题内容
  "rt": 8456,                          // 反应时间(毫秒)
  "button_pressed": null               // 按钮点击(如适用)
}
```

### 测试问题类型
游戏包含两个版本(A/B)，每个版本9个问题，涵盖：

**版本A示例**:
- 哈雷戴维森摩托车最高速度 (公里/小时)
- 平均新生儿身长 (厘米)
- 赛马跑速 (公里/小时)
- 等其他6个问题...

**版本B示例**:
- 蜂鸟翅膀拍动频率 (次/秒)
- 大象妊娠期 (天数)
- 等其他问题...

### 数据字段说明
- **trial_type**: 总是 "survey-html-form"，表示调查表单类型
- **trial_index**: 试验在整个实验中的序号
- **time_elapsed**: 从实验开始到当前试验的总耗时
- **response**: 包含用户输入的数值估计，格式为 `{"response": "用户输入值"}`
- **stimulus**: 完整的问题HTML内容
- **rt**: 该问题的反应时间(毫秒)

### 代码实现位置
- **数据保存函数**: `js/experiment.js` 第18-38行的 `sendResults()` 函数
- **jsPsych设置**: 第1-15行的 `settings` 对象
- **错误处理**: 第27-37行的AJAX错误处理逻辑

### 版本随机化
- **随机机制**: `Math.round(Math.random())` 决定版本顺序
- **实现位置**: 第45-46行
- **目的**: 平衡版本效应，提高数据可靠性

### 错误处理机制
1. **服务器响应200**: 重定向到 `/next` 页面
2. **其他错误**: 调用 `jsPsych.data.get().localSave('csv', 'cognitive-estimation-test.csv')`
3. **本地保存**: 数据以CSV格式下载到用户设备

### 认知评估指标
保存的数据可用于分析：
- **估计精度**: 与标准答案的偏差程度
- **反应时间**: 思考和决策速度
- **一致性**: 不同问题间的表现稳定性
- **极端估计**: 过高或过低估计的频率
- **认知灵活性**: 在不同问题类型间的适应能力

### 技术依赖
- **jsPsych 7.0.0**: 核心实验框架
- **jQuery**: AJAX请求处理
- **Bootstrap 5.1.3**: UI样式框架
- **现代浏览器**: 支持HTML5表单和文件下载

### 数据分析建议
1. 计算每个估计与标准值的相对误差
2. 分析反应时间分布和异常值
3. 比较不同问题类型的估计模式
4. 评估个体认知估计能力的整体水平