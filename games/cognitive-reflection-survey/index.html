<!DOCTYPE html><html class=''>
<head>
    <meta charset='UTF-8'>
    <meta name="robots" content="noindex">
    <title>心理实验工厂：认知反思调查</title>
    
    <link rel='stylesheet' type='text/css' href='css/material.blue-red.min.css'>
    <link rel='stylesheet' type='text/css' href='css/surveys.css'>
    <link rel='stylesheet' type='text/css' href='css/jquery-ui-1.10.4.custom.min.css'>
    <link rel='stylesheet' type='text/css' href='css/style.css'>
</head>

<body>

    <script src='js/jquery-2.1.1.min.js'></script>
    <script src='js/material.min.js'></script>
    <script src='js/jquery-ui-1.10.4.custom.min.js'></script>
    <script src='js/jquery.wizard.js'></script>
    <script src='js/jquery.form-3.50.js'></script>
    <script src='js/jquery.validate-1.12.0.min.js'></script>

<div class="experiment-layout mdl-layout mdl-layout--fixed-header mdl-js-layout mdl-color--grey-100">
<div class="experiment-ribbon"></div>
<main class="experiment-main mdl-layout__content">
<div class="experiment-container mdl-grid">
<div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone">
</div>
<div class="experiment-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col">

<div id="questions">

<form name="questions" action="#", method="POST">
<div class="step">
<h3>欢迎参加本次调查。请按<strong>下一步</strong>开始。</h3><br><br><br><br></div>
<div class="step">
<h3>除最后一题外，请在每道题下方输入您的数字答案。</h3><br><br><br><br></div>
<div class="step">
<p id="cognitive-reflection-survey_2">如果3个精灵可以在1小时内包装3个玩具，那么需要多少个精灵在2小时内包装6个玩具？<br><br><strong>答案</strong>：_____ 个精灵</p>
<div class="mdl-textfield mdl-js-textfield">
<input class="mdl-textfield__input page3 required" type="number" id="cognitive-reflection-survey_2" name="cognitive-reflection-survey_2" meta-text="如果3个精灵可以在1小时内包装3个玩具，那么需要多少个精灵在2小时内包装6个玩具？<br><br><strong>答案</strong>：_____ 个精灵">
<label class="mdl-textfield__label" for="cognitive-reflection-survey_2"></label>
<span class="mdl-textfield__error">输入的不是数字！</span>
</div><br><br><br></div>
<div class="step">
<p id="cognitive-reflection-survey_3">在一个田径队中，高个子队员获得奖牌的可能性是矮个子队员的3倍。今年该队迄今为止共获得60枚奖牌。其中有多少枚是矮个子运动员获得的？<br><br><strong>答案</strong>：_____ 枚奖牌</p>
<div class="mdl-textfield mdl-js-textfield">
<input class="mdl-textfield__input page4 required" type="number" id="cognitive-reflection-survey_3" name="cognitive-reflection-survey_3" meta-text="在一个田径队中，高个子队员获得奖牌的可能性是矮个子队员的3倍。今年该队迄今为止共获得60枚奖牌。其中有多少枚是矮个子运动员获得的？<br><br><strong>答案</strong>：_____ 枚奖牌">
<label class="mdl-textfield__label" for="cognitive-reflection-survey_3"></label>
<span class="mdl-textfield__error">输入的不是数字！</span>
</div><br><br><br></div>
<div class="step">
<p id="cognitive-reflection-survey_4">如果约翰可以在6天内喝完一桶水，玛丽可以在12天内喝完一桶水，那么他们一起喝完一桶水需要多长时间？<br><br><strong>答案</strong>：_____ 天</p>
<div class="mdl-textfield mdl-js-textfield">
<input class="mdl-textfield__input page5 required" type="number" id="cognitive-reflection-survey_4" name="cognitive-reflection-survey_4" meta-text="如果约翰可以在6天内喝完一桶水，玛丽可以在12天内喝完一桶水，那么他们一起喝完一桶水需要多长时间？<br><br><strong>答案</strong>：_____ 天">
<label class="mdl-textfield__label" for="cognitive-reflection-survey_4"></label>
<span class="mdl-textfield__error">输入的不是数字！</span>
</div><br><br><br></div>
<div class="step">
<p id="cognitive-reflection-survey_5">杰瑞在班级中既是第15高分，也是第15低分。班级中有多少名学生？<br><br><strong>答案</strong>：_____ 名学生</p>
<div class="mdl-textfield mdl-js-textfield">
<input class="mdl-textfield__input page6 required" type="number" id="cognitive-reflection-survey_5" name="cognitive-reflection-survey_5" meta-text="杰瑞在班级中既是第15高分，也是第15低分。班级中有多少名学生？<br><br><strong>答案</strong>：_____ 名学生">
<label class="mdl-textfield__label" for="cognitive-reflection-survey_5"></label>
<span class="mdl-textfield__error">输入的不是数字！</span>
</div><br><br><br></div>
<div class="step">
<p id="cognitive-reflection-survey_6">一个人花60美元买了一头猪，以70美元卖出，又以80美元买回，最后以90美元卖出。他赚了多少钱？<br><br><strong>答案</strong>：_____ 美元</p>
<div class="mdl-textfield mdl-js-textfield">
<input class="mdl-textfield__input page7 required" type="number" id="cognitive-reflection-survey_6" name="cognitive-reflection-survey_6" meta-text="一个人花60美元买了一头猪，以70美元卖出，又以80美元买回，最后以90美元卖出。他赚了多少钱？<br><br><strong>答案</strong>：_____ 美元">
<label class="mdl-textfield__label" for="cognitive-reflection-survey_6"></label>
<span class="mdl-textfield__error">输入的不是数字！</span>
</div><br><br><br></div>
<div class="step">
<p id="cognitive-reflection-survey_7_options">西蒙决定在2008年初的一天向股市投资8000美元。他投资6个月后，即7月17日，他购买的股票下跌了50%。幸运的是，从7月17日到10月17日，他购买的股票上涨了75%。此时，西蒙：<br><br><strong>答案</strong>：_____ （请输入字母）</p>
<label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="option-cognitive-reflection-survey_7_0">
<input type="radio" id="option-cognitive-reflection-survey_7_0" class="mdl-radio__button required page8" name="cognitive-reflection-survey_7_options" value="a" meta-options="<strong>(a)</strong> 在股市中不赔不赚|<strong>(b)</strong> 比起初的投资获得了盈利|<strong>(c)</strong> 亏了钱。" meta-text="西蒙决定在2008年初的一天向股市投资8000美元。他投资6个月后，即7月17日，他购买的股票下跌了50%。幸运的是，从7月17日到10月17日，他购买的股票上涨了75%。此时，西蒙：<br><br><strong>答案</strong>：_____ （请输入字母）">
<span class="mdl-radio__label"><strong>(a)</strong> 在股市中不赔不赚</span>
</label>
<label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="option-cognitive-reflection-survey_7_1">
<input type="radio" id="option-cognitive-reflection-survey_7_1" class="mdl-radio__button required page8" name="cognitive-reflection-survey_7_options" value="b" meta-options="<strong>(a)</strong> 在股市中不赔不赚|<strong>(b)</strong> 比起初的投资获得了盈利|<strong>(c)</strong> 亏了钱。" meta-text="西蒙决定在2008年初的一天向股市投资8000美元。他投资6个月后，即7月17日，他购买的股票下跌了50%。幸运的是，从7月17日到10月17日，他购买的股票上涨了75%。此时，西蒙：<br><br><strong>答案</strong>：_____ （请输入字母）">
<span class="mdl-radio__label"><strong>(b)</strong> 比起初的投资获得了盈利</span>
</label>
<label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="option-cognitive-reflection-survey_7_2">
<input type="radio" id="option-cognitive-reflection-survey_7_2" class="mdl-radio__button required page8" name="cognitive-reflection-survey_7_options" value="c" meta-options="<strong>(a)</strong> 在股市中不赔不赚|<strong>(b)</strong> 比起初的投资获得了盈利|<strong>(c)</strong> 亏了钱。" meta-text="西蒙决定在2008年初的一天向股市投资8000美元。他投资6个月后，即7月17日，他购买的股票下跌了50%。幸运的是，从7月17日到10月17日，他购买的股票上涨了75%。此时，西蒙：<br><br><strong>答案</strong>：_____ （请输入字母）">
<span class="mdl-radio__label"><strong>(c)</strong> 亏了钱。</span>
</label><br><br><br><br></div>
<div class="step">
<h3>恭喜您完成了本次任务！请按<strong>完成</strong>继续。</h3><br><br><br><br></div>

<div class="navigation">
    <ul class="clearfix">
        <li><button type="button" 
                    name="backward" 
                    class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent backward">上一步</button></li>
	<li><button type="button" 
                    name="forward" 
                    class="forward mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">下一步</button></li>
        <li><button type="submit" 
                    name="process" 
                    class="submit mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">完成</button></li>
    </ul>
</div>

<div class="pad">
    <div id="progressbar"></div>
</div>
</form>
</div>

<script>
$( document ).ready(function() {

    expfactory_finished = false;

    // Basic wizard with progress bar
    $( "#progressbar" ).progressbar();
    $( "#questions" ).wizard({
        stepsWrapper: "#wrapped",
	submit: ".submit",
	beforeForward: function( event, state ) {

            // Function to add message that answer is required
            function is_required(elements){
                var missing = false;
                elements.each(function(index,element){
                    var pid = "#" + $(element).attr("name")
                    $(pid).css("color","red")
                    missing = true;                   
                });

                if (missing == true){
                   alert("请回答所有用红色标出的必答题。");
                }
            }

             if ( state.stepIndex === 3 ) {
 if (($.unique($(`.page3.required[type=number],.page3.required:text`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required[type=number], [meta-text*="` + this + `"].required:text`).filter(function() { return $(this).val();}).length > 0}).get().indexOf(false) != -1) || ($.unique($(`.page3.required:not([type=number]):not(:text)`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required:checked`).length > 0}).get().indexOf(false) != -1)){
is_required($(`.page3.required:not(checked)`));
return false;
}} else if ( state.stepIndex === 4 ) {
 if (($.unique($(`.page4.required[type=number],.page4.required:text`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required[type=number], [meta-text*="` + this + `"].required:text`).filter(function() { return $(this).val();}).length > 0}).get().indexOf(false) != -1) || ($.unique($(`.page4.required:not([type=number]):not(:text)`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required:checked`).length > 0}).get().indexOf(false) != -1)){
is_required($(`.page4.required:not(checked)`));
return false;
}} else if ( state.stepIndex === 5 ) {
 if (($.unique($(`.page5.required[type=number],.page5.required:text`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required[type=number], [meta-text*="` + this + `"].required:text`).filter(function() { return $(this).val();}).length > 0}).get().indexOf(false) != -1) || ($.unique($(`.page5.required:not([type=number]):not(:text)`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required:checked`).length > 0}).get().indexOf(false) != -1)){
is_required($(`.page5.required:not(checked)`));
return false;
}} else if ( state.stepIndex === 6 ) {
 if (($.unique($(`.page6.required[type=number],.page6.required:text`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required[type=number], [meta-text*="` + this + `"].required:text`).filter(function() { return $(this).val();}).length > 0}).get().indexOf(false) != -1) || ($.unique($(`.page6.required:not([type=number]):not(:text)`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required:checked`).length > 0}).get().indexOf(false) != -1)){
is_required($(`.page6.required:not(checked)`));
return false;
}} else if ( state.stepIndex === 7 ) {
 if (($.unique($(`.page7.required[type=number],.page7.required:text`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required[type=number], [meta-text*="` + this + `"].required:text`).filter(function() { return $(this).val();}).length > 0}).get().indexOf(false) != -1) || ($.unique($(`.page7.required:not([type=number]):not(:text)`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required:checked`).length > 0}).get().indexOf(false) != -1)){
is_required($(`.page7.required:not(checked)`));
return false;
}} else if ( state.stepIndex === 8 ) {
 if (($.unique($(`.page8.required[type=number],.page8.required:text`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required[type=number], [meta-text*="` + this + `"].required:text`).filter(function() { return $(this).val();}).length > 0}).get().indexOf(false) != -1) || ($.unique($(`.page8.required:not([type=number]):not(:text)`).map(function(){return $(this).attr(`meta-text`)})).map(function() {return $(`[meta-text*="` + this + `"].required:checked`).length > 0}).get().indexOf(false) != -1)){
is_required($(`.page8.required:not(checked)`));
return false;
 } else {
expfactory_finished=true;
}}

	    return !!$( this ).wizard( "form" ).valid();
        },
	afterSelect: function( event, state ) {
	    $( "#progressbar" ).progressbar( "value", state.percentComplete );
            if (expfactory_finished == true){
                $(".submit").enable();
            }
        }

    // Form submission
    }).wizard( "form" ).submit(function( event ) {

        event.preventDefault();
        
        var $inputs = $("input:checked");
        var $text = $("input:text")
        var $number = $("input[type = number]")
        var $elements = $inputs.add($text).add($number)
        
        // Prepare data results
        var results = []
        $elements.each(function(index, element) {
            var result = {}

            if ($.inArray( $(element).attr("name"), [ "forward", "backward", "process"] ) == -1) {
                result.name = $(element).attr("name");
                if ($(element).attr("value") == undefined) {
                    result.value = $(element).val();
                } else {
                    result.value = $(element).attr("value");
                }
                result.options = $(element).attr("meta-options");
                result.text = $(element).attr("meta-text");
                results.push(result);
             }
        })

        
        $.ajax({

                type: 'POST',
                url: '/save',
                data: {'data': results},

                success: function() {
                    console.log('success');
                    document.location = '/next'
                 },

                 // Endpoint not running, local save
                 error: function(err) {

                     if (err.status == 200) {
                        document.location = '/next'
                     }        
        
                     console.log("Error with POST" + err.status + ", downloading to local file.")
                     // Save data to browser

                     var data = "text/json;charset=utf-8," + JSON.stringify(results);
                     var a = document.createElement('a');
                     a.title = "Download"
                     a.id = "download"
                     a.type = "button"
                     a.download = 'cognitive-reflection-survey_result.json';
                     a.href = 'data:' + data;
                     $(".submit").html("Download")
                     $(".submit").click(function(){
                         $("body").append(a)
                         a.click()
                     })

                  }
         });

     // Validation
     }).validate({
	errorPlacement: function( error, element ) {
	    if ( element.is( ":radio" ) || element.is( ":checkbox" ) ) {
		error.insertBefore( element.next() );
            } else {
	        error.insertAfter( element );
	 }
      }
  });
});
</script>
</body>
</html>
