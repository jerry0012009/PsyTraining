# 形状匹配测试数据保存机制

## 概述
这是一个基于jsPsych框架开发的形状匹配认知测试，用于评估个体的视觉形状识别能力和反应抑制控制能力。测试时长约20分钟，包含练习阶段和正式测试。

## 测试内容

### 1. 实验任务
- **目标任务**: 比较屏幕右侧白色形状与左侧绿色形状是否相同
- **按键反应**: 相同按"M"键，不同按"Z"键
- **干扰条件**: 部分试验中显示红色干扰形状(需要忽略)
- **试验类型**: 包含7种不同的形状匹配条件组合

### 2. 实验流程
- **练习阶段**: 21次试验，提供反馈
- **正式测试**: 280次试验，分4个区块，包含休息时间
- **时间限制**: 每次反应时间限制2秒

### 3. 认知测量维度
- **形状识别**: 基本视觉形状辨别能力
- **注意控制**: 忽略干扰刺激的能力
- **反应速度**: 信息处理和决策速度
- **持续注意**: 长时间任务中保持专注的能力

## 数据保存方式

### 1. 数据采集
使用jsPsych框架自动记录每个试验的详细数据：
```javascript
// 主要数据字段
{
    "trial_id": "试验标识",
    "exp_stage": "练习/正式测试阶段",
    "trial_num": "试验编号", 
    "condition": "试验类型(SSS/SDD/等)",
    "probe_id": "探测形状ID",
    "target_id": "目标形状ID", 
    "distractor_id": "干扰形状ID",
    "correct_response": "正确按键编码",
    "key_press": "用户实际按键",
    "rt": "反应时间(毫秒)",
    "correct": "回答是否正确",
    "credit_var": "整体表现评估"
}
```

### 2. 保存机制

#### 服务器保存（首选）
- **触发时机**: 实验完成时自动触发(`on_finish`回调)
- **数据序列化**: `jsPsych.data.dataAsJSON()` 生成JSON格式数据
- **请求方式**: AJAX POST请求到 `/save` 端点
- **数据包装**: `{"data": 序列化的JSON数据}`
- **成功处理**: 重定向到 `/next` 页面

#### 本地保存（备用方案）
- **触发条件**: 服务器请求失败且状态码不为200
- **保存方式**: 使用jsPsych内置方法`jsPsych.data.localSave()`
- **文件格式**: CSV格式
- **文件名**: `shape-matching_results.csv`
- **下载方式**: 自动触发浏览器下载

### 3. 性能评估算法
系统自动计算实验表现指标：
- **错失试验率**: 未响应试验的比例
- **平均反应时**: 有效反应的中位数反应时间
- **按键分布**: 检查是否存在偏向性反应模式
- **信用变量**: 综合表现是否合格的布尔值

### 4. 技术实现特点
- **jsPsych框架**: 专业心理学实验平台，确保数据精确性
- **全屏模式**: 减少外界干扰，提高数据质量
- **随机化**: 试验顺序随机，避免顺序效应
- **图像预加载**: 确保刺激呈现时间准确
- **实时数据收集**: 每个试验完成后立即记录数据

### 5. 数据应用价值
收集的数据可用于：
- **认知能力评估**: 视觉注意和执行控制能力
- **临床诊断辅助**: ADHD、注意缺陷等疾病筛查
- **认知训练效果**: 前后测对比评估
- **个体差异研究**: 年龄、性别等因素对认知的影响

## 注意事项
- CSV文件包含所有试验的原始数据，需要统计软件进行分析
- 反应时间数据以毫秒为单位，需要注意数据清洗
- 建议在控制良好的环境下进行测试，确保结果可靠
- 数据包含个体认知能力信息，需要遵守数据保护规范
- 实验过程不可暂停，请确保测试环境稳定