# 是否相等？(闪电模式) - 数据保存机制

## 概述

这是一个基于Phaser.js游戏引擎的认知游戏，使用"phaser"模板，用于测试用户在时间压力下进行数量比较和判断的能力。游戏要求用户在限定时间内快速判断两组物体的数量是否相等。

## 游戏特点

- **游戏时长**：约10分钟
- **核心任务**：快速数量比较与相等性判断
- **时间限制**：闪电模式强调反应速度
- **认知能力**：数量感知、注意力、处理速度

## 数据保存机制

### 数据收集

游戏使用以下全局变量收集数据：
- `data`：当前试次的数据对象
- `taskdata`：存储所有试次数据的数组

### 数据记录流程

1. **试次数据收集**：
   - 每完成一个试次，调用 `sendData(trial)` 函数
   - 通过 `inputData(field, value)` 记录各项数据
   - 数据被推送到 `taskdata` 数组中

2. **游戏结束判断**：
   - 当 `data.finished == 1` 时触发保存流程

### 保存流程

1. **服务器端保存（首选）**：
   - 游戏结束时，将 `taskdata` 数据通过AJAX POST请求发送到 `/save` 端点
   - 数据格式为JSON字符串
   - 成功后跳转到 `/next` 页面

2. **本地保存（备用）**：
   - 如果服务器端点不可用或返回错误，系统自动创建下载链接
   - 生成JSON格式的数据文件
   - 2秒延迟后显示"下载"按钮，用户点击下载文件

### 数据格式

保存的数据为JSON数组格式，每个试次包含：

```json
[
  {
    "trial": "试次编号",
    "timestamp": "时间戳",
    "response": "用户响应",
    "correct": "是否正确",
    "reaction_time": "反应时间",
    "stimulus": "刺激描述",
    // 其他游戏特定数据字段
  }
]
```

### 认知评估维度

该游戏测量以下认知能力：

1. **处理速度**：在时间压力下的反应速度
2. **注意力**：对视觉刺激的快速关注和处理
3. **数量感知**：快速数量比较能力
4. **执行功能**：决策制定和反应抑制

### 技术实现

- **游戏引擎**：Phaser.js
- **物理引擎**：Box2D插件
- **前端技术**：jQuery + 原生JavaScript
- **游戏状态管理**：Boot, Preloader, Menu, Instructions, Run

### 游戏状态流程

1. **Boot**：初始化游戏
2. **Preloader**：加载资源
3. **Menu**：主菜单
4. **Instructions**：游戏说明
5. **Run**：游戏运行和数据收集

## 使用说明

1. 游戏自动运行并收集数据
2. 完成所有试次后自动触发保存
3. 如出现"下载"按钮，点击获取JSON数据文件
4. 数据文件包含完整的游戏表现数据

## 注意事项

- **文件命名bug**：当前版本中下载文件名为 `add-it-up-lightning_result.json`，应为 `is-it-equal-lightning_result.json`
- 确保浏览器允许自动下载文件
- JSON文件包含详细的认知任务表现数据
- 适用于注意力和处理速度的评估研究
- 游戏数据可用于认知能力的定量分析