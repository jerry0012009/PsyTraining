# 人口统计学调查 - 数据保存机制

## 概述
人口统计学调查是一个标准化的问卷调查游戏，用于收集参与者的基本人口统计信息，包括性别、年龄、种族、教育水平、收入等关键特征，为心理学研究提供重要的背景数据。

## 数据保存机制

### 保存位置和方式
- **主要方式**: AJAX POST请求到服务器端点 `/save`
- **备用方式**: 当服务器不可用时，自动下载JSON文件到本地
- **文件名**: `demographics-survey_result.json`

### 数据保存流程
1. 参与者逐步完成多页面调查问卷
2. 使用jQuery Wizard插件进行分页导航和验证
3. 表单提交时收集所有已填写的数据
4. 通过AJAX POST发送到 `/save` 端点
5. 如果服务器请求失败，自动触发本地下载

### 保存的数据结构
```javascript
[
  {
    "name": "demographics-survey_2_options",     // 性别问题
    "value": "1",                               // 选择值(0=男性, 1=女性)
    "options": "Male|Female",                   // 选项文本
    "text": "What is your sex?"                  // 英文问题描述
  },
  {
    "name": "demographics-survey_3",            // 年龄问题
    "value": "25",                             // 用户输入的年龄
    "options": undefined,                      // 数值输入无选项
    "text": "How old are you (in years)?"      // 英文问题描述
  },
  // ... 其他人口统计信息问题
]
```

### 主要调查内容
调查涵盖以下人口统计学维度：

1. **基本信息**:
   - 性别 (男性/女性)
   - 年龄 (数值输入)
   
2. **社会经济状态**:
   - 教育水平
   - 职业状况
   - 家庭收入水平
   
3. **种族/民族背景**:
   - 种族分类选择
   - 民族认同
   
4. **地理信息**:
   - 居住地区
   - 城乡分类

### 数据字段说明
- **name**: 问题的唯一标识符，格式为 `demographics-survey_[问题编号]` 或 `demographics-survey_[问题编号]_options`
- **value**: 用户的选择或输入值
  - 单选题：数值索引(0, 1, 2...)
  - 文本输入：用户输入的原始文本
  - 数值输入：数字字符串
- **options**: 单选题的选项文本，用"|"分隔，文本输入题为undefined
- **text**: 问题的英文原始描述

### 分页验证机制
- **必填验证**: 每页都有必填字段验证，未完成无法进入下一页
- **数据类型验证**: 年龄等数值字段进行类型检查
- **进度跟踪**: 使用jQuery UI进度条显示完成进度
- **错误提示**: 未完成必填项时显示红色标记和提示信息

### 代码实现位置
- **数据收集**: `index.html` 第710-735行的表单数据处理
- **AJAX保存**: 第738-773行的POST请求和错误处理
- **本地保存**: 第759-770行的文件下载机制
- **分页控制**: 第580-623行的jQuery Wizard配置

### 错误处理机制
1. **服务器响应200**: 重定向到 `/next` 页面
2. **其他错误**: 自动下载JSON文件
3. **按钮状态切换**: 错误时将"完成"按钮改为"Download"
4. **控制台日志**: 记录请求成功/失败状态

### 国际化支持
- **双语显示**: 界面使用中文，数据保存英文标识符
- **文化适配**: 问题内容适配中国用户背景
- **选项本地化**: 选项文本支持中文显示

### 数据用途
保存的数据可用于：
- 研究样本的人口统计学描述
- 控制变量和协变量分析
- 样本代表性评估
- 跨组比较和分层分析
- 研究伦理和合规性文档

### 隐私保护
- **匿名化**: 不收集姓名、身份证等个人身份信息
- **最小化**: 仅收集研究必需的人口统计信息
- **数据安全**: 支持服务器端安全存储和本地保存选项

### 技术依赖
- **jQuery Wizard**: 多步骤表单导航
- **jQuery Validate**: 表单验证
- **Material Design Lite**: UI组件和样式
- **jQuery UI**: 进度条和交互组件
- **现代浏览器**: 支持HTML5表单和文件下载API

### 研究应用建议
1. 在数据分析前进行数据清洗和一致性检查
2. 根据研究目的选择相关的人口统计学变量
3. 考虑样本偏差和代表性问题
4. 遵守数据保护和隐私法规要求
5. 建立适当的数据存储和访问权限控制