# Tower of London 任务数据保存说明

## 任务概述
Tower of London（伦敦塔）任务是经典的执行功能和计划能力测试，评估被试解决复杂空间规划问题的能力。被试需要通过最少的移动步数将球的排列从初始状态转换为目标状态。

## 数据保存机制

### 技术架构
- **实验框架**: jsPsych 实验心理学框架
- **交互插件**: single-stim-button 插件，支持鼠标点击交互
- **动态界面**: JavaScript动态生成棋盘和球的HTML表示
- **时间控制**: 每题20秒时间限制，实时计时

### 任务设计

#### 棋盘设置
- **木桩结构**: 3根木桩，容量分别为3、2、1个球
- **球的颜色**: 绿色、红色、蓝色三种颜色球
- **初始配置**: 第一根桩2球（绿、红），第二根桩1球（蓝）
- **交互方式**: 点击木桩进行球的拾取和放置

#### 实验阶段结构
1. **练习阶段**: 1个练习问题，学习操作方法
2. **正式测试**: 12个测试问题，难度递增
3. **问题分类**: 按最少移动步数分为2-5步问题

### 保存的数据字段

#### 试验基础信息
```javascript
{
    trial_id: "to_hand|to_board",   // 拾取或放置动作
    exp_stage: "practice|test",     // 实验阶段  
    problem_id: 0,                  // 问题编号或"practice"
    min_moves: 2,                   // 理论最少移动步数
    target: [[3,0,0],[2,1],[0]]     // 目标配置
}
```

#### 移动与计时数据
- **current_position**: 当前球的位置配置
- **num_moves_made**: 实际移动步数
- **rt**: 单次移动的反应时间
- **problem_time**: 解决问题的总时间
- **mouse_click**: 点击的木桩编号

#### 表现评估数据
- **correct**: 是否成功达到目标配置
- **timing_exceeded**: 是否超过时间限制
- **efficiency**: 移动效率（最少步数/实际步数）

### 问题库设计

#### 难度分级结构
```javascript
// 12个测试问题，按难度递增
var problems = [
    // 2步问题 (前2题)
    [[0,0,0],[3,1],[2]],        // 问题0: 2步
    [[1,0,0],[2,0],[3]],        // 问题1: 2步
    
    // 3步问题 (问题2-3)  
    [[1,3,0],[2,0],[0]],        // 问题2: 3步
    [[1,0,0],[2,3],[0]],        // 问题3: 3步
    
    // 4步问题 (问题4-7)
    [[2,1,0],[3,0],[0]],        // 问题4: 4步
    // ... 更多4步问题
    
    // 5步问题 (问题8-11)  
    [[2,1,3],[0,0],[0]],        // 问题8: 5步
    // ... 更多5步问题
];

var answers = [2,2,3,3,4,4,4,4,5,5,5,5]; // 对应的最少移动步数
```

### 交互机制设计

#### 球移动逻辑
```javascript
var pegClick = function(peg_id) {
    var choice = Number(peg_id.slice(-1)) - 1; // 获取木桩编号
    var peg = curr_placement[choice];
    
    if (held_ball === 0) {          // 当前未持球
        // 拾取最上面的球
        for (var i = peg.length - 1; i >= 0; i--) {
            if (peg[i] !== 0) {
                held_ball = peg[i];
                peg[i] = 0;
                num_moves += 1;     // 移动计数
                break;
            }
        }
    } else {                        // 当前持球
        // 放置到可用位置
        var open_spot = peg.indexOf(0);
        if (open_spot != -1) {
            peg[open_spot] = held_ball;
            held_ball = 0;
        }
    }
}
```

#### 界面状态管理
- **动态棋盘生成**: 实时反映球的当前位置
- **手持球显示**: 单独区域显示当前拾取的球
- **木桩状态**: 视觉反馈可点击和不可点击区域

### 计时与时间管理

#### 时间控制系统
```javascript
var getTime = function() {
    if ((time_per_trial - time_elapsed) > 0) {
        return time_per_trial - time_elapsed;
    } else {
        return 1;  // 时间用完，但给1ms完成当前动作
    }
}
```

#### 时间记录机制
- **time_per_trial**: 每题总时间限制（20秒）
- **time_elapsed**: 已用时间累计
- **实时更新**: 每次点击后更新已用时间

### 任务完成判断

#### 目标达成检验
```javascript
var arraysEqual = function(arr1, arr2) {
    // 深度比较当前配置与目标配置
    if (arr1.length !== arr2.length) return false;
    for (var i = arr1.length; i--;) {
        if (arr1[i] !== arr2[i]) return false;
    }
    return true;
}

// 检查所有木桩的配置
for (var i = 0; i < target.length; i++) {
    isequal = arraysEqual(target[i], current_position[i]);
    if (isequal === false) break;
}
```

### 数据分析指标

#### 规划效率测量
1. **移动效率**: 实际步数/最少步数比值
2. **计划时间**: 第一次移动前的思考时间  
3. **执行时间**: 完成所有移动的总时间
4. **错误移动**: 非最优路径的移动次数

#### 认知策略分析
1. **前瞻规划**: 是否在开始前制定完整计划
2. **试探策略**: 是否通过试错寻找解决方案
3. **局部优化**: 是否陷入局部最优的移动模式
4. **坚持行为**: 重复无效移动的次数

### 执行功能评估

#### 规划能力指标
1. **抽象规划**: 从当前状态到目标状态的路径规划
2. **工作记忆**: 维持目标状态和当前状态的表征
3. **抑制控制**: 抑制立即但非最优的移动冲动
4. **认知灵活性**: 调整策略和修正错误路径

#### 问题解决策略
- **自顶向下**: 从目标状态反向规划
- **自底向上**: 从当前状态正向搜索
- **子目标分解**: 将复杂问题分解为简单步骤
- **启发式策略**: 使用经验法则简化搜索

### 临床神经心理学应用

#### 前额叶功能评估
- **背外侧前额叶**: 工作记忆和执行控制
- **腹内侧前额叶**: 决策制定和冲动控制
- **前扣带皮层**: 冲突监控和错误检测

#### 认知障碍筛查
1. **执行功能障碍**: 规划和问题解决缺陷
2. **工作记忆缺陷**: 多步骤任务执行困难
3. **抑制控制问题**: 冲动性移动和策略坚持
4. **注意缺陷**: 目标维持和任务转换困难

### 发展与个体差异

#### 年龄发展轨迹
- **儿童期**: 规划能力逐渐发展，策略日趋成熟
- **青少年期**: 执行功能快速发展阶段
- **成年期**: 规划能力达到峰值
- **老年期**: 执行功能和处理速度衰退

#### 个体差异来源
- **认知能力**: 工作记忆容量和处理速度
- **策略偏好**: 前瞻规划vs试错学习
- **动机因素**: 追求完美vs满意即可的策略

### 数据导出格式
jsPsych自动保存为JSON格式，包含：
- 每次移动的详细记录和时间戳
- 问题配置和解决过程的完整轨迹
- 效率指标和认知策略分析数据
- 可重现问题解决过程的完整信息

## 临床应用价值
Tower of London任务广泛应用于：
- **执行功能评估**: 规划、工作记忆、抑制控制综合评估
- **前额叶功能**: 脑损伤和疾病对执行功能的影响
- **认知康复**: 制定针对性的认知训练方案
- **神经发育**: 儿童执行功能发展的追踪评估
- **精神病理**: 精神分裂症、抑郁症等的认知评估

## 注意事项
- 确保被试理解球的拾取-放置操作逻辑
- 强调寻找最少步数解决方案的重要性
- 注意时间压力对规划策略的影响
- 观察被试是否采用前瞻规划vs试错策略