# Spatial Span 任务数据保存说明

## 任务概述
Spatial Span（空间广度）任务是经典的视觉空间工作记忆测试，评估被试记忆和复述空间位置序列的能力，分为顺向和逆向两种条件。

## 数据保存机制

### 技术架构
- **实验框架**: jsPsych 实验心理学框架
- **刺激呈现**: poldrack-multi-stim-multi-response 插件（序列呈现）
- **反应收集**: single-stim-button 插件（点击式反应）
- **自适应算法**: 阶梯法调整序列长度

### 任务设计

#### 刺激设置
- **空间网格**: 5×5方格阵列（25个位置）
- **刺激标记**: 红色方格序列呈现
- **呈现时间**: 每个位置1000ms
- **反应方式**: 鼠标点击网格位置

#### 实验阶段结构
1. **顺向序列**: 14个试验，按原顺序复述
2. **逆向序列**: 14个试验，按倒序复述
3. **序列长度**: 从3个位置开始，根据表现调整

### 保存的数据字段

#### 序列呈现数据
```javascript
{
    trial_id: "stim",              // 刺激呈现试验
    exp_stage: "test",             // 实验阶段
    sequence: [12, 7, 23],         // 呈现的位置序列
    num_spaces: 3                  // 当前序列长度
}
```

#### 反应数据
```javascript
{
    trial_id: "response",          // 反应试验
    exp_stage: "test",             // 实验阶段
    response: [12, 7, 23],         // 被试点击的位置序列
    sequence: [12, 7, 23],         // 原始目标序列
    num_spaces: 3,                 // 序列长度
    condition: "forward|reverse",   // 顺向或逆向条件
    correct: true                  // 序列复述正确性
}
```

#### 时间控制数据
- **timing_stim**: 每个位置的呈现时间数组
- **total_time**: 整个序列的总呈现时间
- **timing_response**: 反应收集的最大时间

### 阶梯法序列调整

#### 自适应长度算法
```javascript
// 序列长度调整规则
if (arraysEqual(response, curr_seq)) {
    num_spaces += 1;               // 正确则增加长度
    feedback = '正确！';
} else {
    errors += 1;                   // 错误计数
    if (num_spaces > 1 && errors == 2) {
        num_spaces -= 1;           // 连续2错则减少长度
        errors = 0;                // 重置错误计数
    }
    feedback = '错误';
}
```

#### 序列参数管理
- **初始长度**: 3个位置
- **最大长度**: 理论上无上限
- **最小长度**: 1个位置
- **错误容忍**: 每个长度允许1次错误

### 刺激生成机制

#### 随机序列生成
```javascript
var setStims = function() {
    curr_seq = [];
    var spaces = [1,2,3,...,25];   // 所有可能位置
    var last_space = 0;            // 防止连续重复
    
    for (var i = 0; i < num_spaces; i++) {
        // 从未选位置中随机选择
        var space = randomDraw(spaces.filter(x => x != last_space));
        curr_seq.push(space);
        last_space = space;
    }
}
```

#### 网格界面生成
- **呈现阶段**: 红色高亮显示目标位置
- **反应阶段**: 点击式交互界面，支持清除和提交
- **反馈阶段**: 即时正确/错误反馈

### 数据分析指标

#### 工作记忆容量测量
1. **最大序列长度**: 能够正确复述的最大空间序列
2. **平均表现长度**: 所有试验的平均序列长度
3. **顺向vs逆向对比**: 两种条件下的容量差异
4. **学习效应**: 任务进行中的表现改善

#### 错误分析类型
1. **序列错误**: 位置记忆正确但顺序错误
2. **位置错误**: 记忆了错误的空间位置
3. **长度错误**: 遗漏或增加序列项目
4. **坚持错误**: 重复点击同一位置

### 认知功能评估

#### 工作记忆成分
1. **视觉空间暂存器**: 空间位置的短暂存储
2. **中央执行器**: 序列控制和注意分配
3. **情景缓冲器**: 序列整合和时间编码
4. **反向处理**: 逆向条件的额外执行负荷

#### 顺向vs逆向对比
- **顺向广度**: 视觉空间工作记忆的基础容量
- **逆向广度**: 需要额外的序列操作和执行控制
- **广度差异**: 反映执行功能的独特贡献

### 质量控制机制

#### 任务理解检验
- 练习阶段确保被试理解任务要求
- 清除按钮允许修正错误输入
- 提交确认防止意外操作

#### 数据质量指标
- **完成率**: 所有试验的完成情况
- **反应一致性**: 避免随机点击模式
- **时间合理性**: 排除过快或过慢反应

### 实验流程设计

#### 试验序列
1. **序列长度提示**: "X Squares"显示当前长度
2. **刺激呈现**: 依次闪烁红色方格
3. **反应收集**: 点击网格复述序列
4. **即时反馈**: 正确/错误提示
5. **长度调整**: 根据表现更新难度

#### 条件切换
- **阶段间休息**: 顺向结束后的指导说明
- **任务重置**: 逆向阶段重新从3个位置开始
- **参数重新初始化**: 错误计数和序列长度重置

### 临床应用指标

#### 神经心理评估
- **视觉空间工作记忆**: 右半球功能评估
- **序列学习能力**: 海马-新皮质系统功能
- **执行功能**: 逆向条件的额外认知负荷
- **注意控制**: 维持序列信息的注意资源

#### 发展与老化研究
- **儿童认知发展**: 工作记忆容量的年龄变化
- **老化认知评估**: 执行功能和工作记忆衰退
- **个体差异**: 认知能力的人群分布

### 数据导出格式
jsPsych自动保存为JSON格式，包含：
- 每个试验的序列信息和反应数据
- 阶梯法调整过程和最终容量
- 顺向和逆向条件的分离数据
- 错误类型和反应时间信息

## 临床应用价值
Spatial Span任务广泛应用于：
- **工作记忆评估**: 视觉空间工作记忆容量测量
- **神经心理评估**: 右半球和额叶功能评估
- **学习障碍诊断**: 工作记忆缺陷的客观测量
- **认知训练效果**: 工作记忆训练前后对比
- **老龄化研究**: 认知老化的敏感指标

## 注意事项
- 确保被试理解序列复述的要求
- 区分顺向和逆向条件的不同认知需求
- 注意防止外部记忆策略（如书写、发声）
- 监控序列长度调整的合理性