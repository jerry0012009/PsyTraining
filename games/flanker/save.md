# Flanker任务 - 数据保存机制

## 概述
Flanker任务是一个经典的认知心理学实验，由Eriksen和Eriksen在1974年首次提出，用于测量选择性注意和认知控制能力。该任务通过呈现由目标刺激和分心刺激组成的字母串，要求参与者对中心目标刺激做出反应，同时忽略周围的干扰刺激。Flanker任务是研究执行注意、冲突监测和认知控制的重要工具，广泛应用于认知神经科学和临床神经心理学研究。

## 数据保存机制

### 保存位置和方式
- **主要方式**: AJAX POST请求到服务器端点 `/save`
- **备用方式**: 当服务器不可用时，自动下载CSV文件到本地
- **文件格式**: JSON格式（服务器）或CSV格式（本地）
- **文件名**: `flanker_results.csv`

### 数据保存流程
1. 使用jsPsych框架管理整个实验流程和数据收集
2. 每个试次完成后自动记录反应时间、正确性等数据
3. 实验结束时序列化所有数据为JSON格式
4. 优先通过AJAX POST发送到服务器
5. 服务器不可用时触发本地CSV文件下载

### jsPsych数据结构
```javascript
{
  "rt": 756,                             // 反应时间(毫秒)
  "stimulus": "<div class=centerbox><div class=flanker-text>ffhff</div></div>", // 呈现的刺激
  "key_press": 72,                       // 按键响应(70='F', 72='H')
  "correct": true,                       // 反应正确性
  "trial_type": "poldrack-categorize",   // 试次类型
  "trial_index": 25,                     // 试次索引
  "time_elapsed": 12450,                 // 实验开始以来的总时间
  "internal_node_id": "0.0.2.1",        // jsPsych内部节点ID
  "subject": "flanker-001",              // 被试标识符
  "trial_id": "stim",                    // 自定义试次标识
  "exp_stage": "test",                   // 实验阶段(practice/test)
  "condition": "incompatible",           // 条件类型(compatible/incompatible)
  "correct_response": 72,                // 正确反应键值
  "flanker_type": "center_h_flanker_f",  // 具体刺激类型
  "conflict_condition": "incongruent"     // 冲突条件
}
```

### 实验设计与刺激

#### 刺激类型 (`experiment.js:61-89`):
**兼容条件 (Compatible/Congruent)**:
- `hhhhh` → 正确反应: 'H' (键值72)
- `fffff` → 正确反应: 'F' (键值70)
- 特点: 目标刺激与分心刺激相同，无冲突

**不兼容条件 (Incompatible/Incongruent)**:  
- `ffhff` → 正确反应: 'H' (键值72)
- `hhfhh` → 正确反应: 'F' (键值70)
- 特点: 目标刺激与分心刺激不同，存在冲突

#### 实验结构:
1. **指导阶段**: 详细说明任务要求和反应规则
2. **练习阶段**: 12个试次，每次反应后给予反馈
3. **正式测试**: 100个试次，每次反应后给予反馈
4. **后测问卷**: 收集主观体验和策略报告

#### 试次时间流程:
- 注视点呈现: 500ms
- 刺激呈现: 最多1500ms（或直至反应）
- 反馈呈现: 1000ms
- 试次间隔: 500ms

### 核心认知测量

1. **Flanker效应 (Flanker Effect)**:
   - 定义: 不兼容条件相对于兼容条件的反应时延迟
   - 计算: RT(不兼容) - RT(兼容)
   - 反映: 认知控制和冲突解决能力

2. **Simon效应 (Simon Effect)**:
   - 虽然本任务不直接测量，但可分析刺激位置效应
   - 反映空间注意和反应选择的相互作用

3. **错误相关负波 (Error-Related Negativity, ERN)**:
   - 错误试次可用于EEG研究中的ERN分析
   - 反映错误监测和认知控制神经机制

### 数据保存实现代码

**实验初始化和数据收集** (`index.html:31-37`):
```javascript
jsPsych.init({
    timeline: flanker_experiment,
    on_trial_finish: function(data){
        addID('flanker')  // 添加实验标识符
    }
})
```

**实验结束数据保存** (`index.html:39-69`):
```javascript
on_finish: function(data){
    var data = jsPsych.data.dataAsJSON();
    $.ajax({
        type: "POST",
        url: '/save',
        data: { "data": data },
        success: function(){ document.location = "/next" },
        error: function(err) {
            if (err.status == 200){
                document.location = "/next";
            } else {
                jsPsych.data.localSave('flanker_results.csv', 'csv');
            }
        }
    });
}
```

### 认知心理学理论基础

1. **注意网络理论 (Attention Network Theory)**:
   - **执行网络 (Executive Network)**: Flanker任务主要测量执行注意
   - **冲突监测**: 检测和解决认知冲突的能力
   - **认知控制**: 抑制无关信息，聚焦相关信息

2. **冲突监测理论 (Conflict Monitoring Theory)**:
   - **前扣带皮层 (ACC)**: 监测认知冲突
   - **背外侧前额叶 (DLPFC)**: 实施认知控制
   - **冲突适应**: 前一试次冲突对当前试次的影响

3. **双通路模型 (Dual Route Model)**:
   - **自动通路**: 分心刺激的自动加工
   - **控制通路**: 目标刺激的控制加工
   - **通路竞争**: 两个通路间的竞争产生干扰效应

### 关键测量指标

1. **反应时间分析**:
   - 兼容条件平均反应时间
   - 不兼容条件平均反应时间
   - Flanker效应量 (不兼容RT - 兼容RT)
   - 反应时间变异性 (RT标准差)

2. **正确率分析**:
   - 兼容条件正确率
   - 不兼容条件正确率
   - 错误类型分析 (遗漏vs错误反应)

3. **效率指标**:
   - 逆效率分数 (RT/正确率)
   - 线性混合效应模型分析
   - 信号检测论指标 (d', c)

### 数据质量控制

1. **反应时间过滤** (`experiment.js:268, 241`):
   - 设置1500ms反应时间上限
   - 过快反应(<100ms)和过慢反应的识别
   - 连续错误试次的标记

2. **注意力检查** (`experiment.js:111-126`):
   - 可选的注意力检查试次
   - 检查参与者是否保持专注
   - 通过率阈值设置(45%)

3. **练习效果控制**:
   - 充分的练习试次(12个)确保理解任务
   - 实时反馈帮助学习正确反应规则
   - 练习和测试阶段的分离标记

### 实验参数设置

**刺激参数** (`experiment.js:91-94`):
- 练习试次: 12个
- 测试试次: 100个  
- 刺激类型: 4种(2兼容 + 2不兼容)
- 随机化: 每种条件等概率呈现

**时间参数**:
- 刺激呈现时间: 1500ms最大
- 反馈持续时间: 1000ms
- 试次间间隔: 500ms
- 注视点持续时间: 500ms

### 神经科学应用

1. **EEG/ERP研究**:
   - N2成分: 冲突检测的电生理标记
   - ERN: 错误监测的神经指标
   - P3成分: 目标检测和注意分配

2. **fMRI研究**:
   - 前扣带皮层: 冲突监测
   - 前额叶皮层: 认知控制
   - 顶叶皮层: 注意定向

3. **临床应用**:
   - ADHD: 执行注意缺陷评估
   - 焦虑障碍: 注意偏向测量
   - 老化研究: 认知控制衰退

### 个体差异因素

1. **年龄效应**:
   - 儿童: Flanker效应较大，认知控制发展中
   - 老年人: 反应时间延长，冲突解决能力下降
   - 成人: 最优的认知控制表现

2. **个体特质**:
   - 工作记忆容量与Flanker效应负相关
   - 特质焦虑影响错误监测敏感性
   - 人格因素与注意控制策略关联

3. **认知状态**:
   - 疲劳增加Flanker效应
   - 情绪状态调节注意控制
   - 动机水平影响任务表现

### 数据分析方法

1. **传统分析**:
   - 重复测量ANOVA (2×2设计: 兼容性×实验阶段)
   - 配对t检验比较兼容vs不兼容条件
   - 相关分析检验RT与准确率关系

2. **高级分析**:
   - 线性混合效应模型处理试次水平数据
   - 贝叶斯分析量化证据强度
   - 机器学习分类个体差异模式

3. **序列效应分析**:
   - 冲突适应效应 (前一试次类型的影响)
   - Gratton效应 (冲突试次后的适应)
   - 错误后减慢效应分析

### 实验设计优势

1. **高信度**:
   - 大量试次确保测量稳定性
   - 标准化刺激和程序
   - 跨文化一致性好

2. **高效性**:
   - 实验时间适中(约15分钟)
   - 自动化数据收集和分析
   - 批量测试友好

3. **理论基础**:
   - 50年研究历史积累
   - 理论模型完善
   - 神经机制清楚

### 技术实现特点

1. **jsPsych框架优势**:
   - 精确时间控制和测量
   - 跨平台兼容性
   - 丰富的插件支持
   - 标准化实验流程

2. **刺激呈现控制**:
   - HTML/CSS精确控制视觉呈现
   - 字体和大小标准化
   - 屏幕居中对齐
   - 跨设备一致性

3. **数据完整性**:
   - 试次级数据自动记录
   - 错误处理和恢复机制
   - 多重保存备份策略

### 扩展研究方向

1. **任务变体**:
   - 空间Flanker任务
   - 数字Flanker任务  
   - 情绪Flanker任务
   - 多感觉通道Flanker

2. **结合技术**:
   - 眼动追踪分析注意分配
   - 脑电/磁共振同步记录
   - 虚拟现实环境下的测试
   - 移动设备适配版本

3. **应用拓展**:
   - 教育评估工具
   - 临床诊断辅助
   - 驾驶能力评估
   - 认知训练游戏

### 结果解释指导

1. **正常表现**:
   - Flanker效应: 通常30-100ms
   - 总体正确率: >90%
   - 兼容条件RT: 400-600ms
   - 不兼容条件RT: 450-650ms

2. **异常表现标识**:
   - 过大Flanker效应(>150ms): 认知控制困难
   - 极低正确率(<80%): 理解或动机问题
   - 极快反应(<200ms): 冲动反应倾向
   - 极慢反应(>1200ms): 决策困难或注意缺陷

3. **临床意义**:
   - 执行功能评估的客观指标
   - 注意力疾病的辅助诊断
   - 认知干预效果的评估工具
   - 神经退行性疾病的早期检测

### 研究伦理考虑

1. **参与者安全**:
   - 避免过度疲劳的试次设计
   - 明确的任务指导和练习
   - 随时退出的权利保护

2. **数据隐私**:
   - 匿名化数据处理
   - 安全的数据传输和存储
   - 明确的数据使用范围

3. **知情同意**:
   - 详细解释实验内容和目的
   - 说明可能的认知负荷
   - 保障参与的自愿性

该Flanker任务实现提供了一个标准化、高质量的认知控制测量工具，适用于基础研究、临床评估和教育应用等多个领域。其完善的数据保存机制确保了实验数据的完整性和可靠性，为后续的科学分析提供了坚实基础。